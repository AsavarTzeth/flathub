{
  "app-id": "com.github.djfun.audio-visualizer-python",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "1.6",
  "sdk": "org.freedesktop.Sdk",
  "command": "avp.wrapper",
  "finish-args": [
    /* X11 + XShm access */
    "--share=ipc", "--socket=x11",
    "--socket=wayland",
    "--socket=pulseaudio",
    "--filesystem=home:rw",
    "--persist=.config/audio-visualizer"
  ],
  "cleanup": [
    "/include",
    "/lib/pkgconfig"
  ],
  "modules": [
    {
      "name": "audio-visualizer-python",
      "buildsystem": "simple",
      "build-commands": [
        "python3 setup.py install --prefix=/app --root=/ --optimize=1"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/djfun/audio-visualizer-python.git",
          "branch": "feature-newgui",
          "commit": "6f8f178778c63f10b3bda42507c7d44f98884fcd"
        },
        {
          "type": "file",
          "path": "com.github.djfun.audio-visualizer-python.appdata.xml"
        },
        {
          "type": "file",
          "path": "avp.wrapper"
        }
      ],
      "post-install": [
        "install -Dm644 com.github.djfun.audio-visualizer-python.appdata.xml /app/share/appdata/com.github.djfun.audio-visualizer-python.appdata.xml",
        "install -Dm755 avp.wrapper /app/bin/avp.wrapper"
      ],
      "modules": [
        "qt5-qtbase-5.9.1.json",
        {
          "name": "pyqt5",
          "sources": [
            {
              "type": "archive",
              "url": "https://sourceforge.net/projects/pyqt/files/PyQt5/PyQt-5.9/PyQt5_gpl-5.9.tar.gz",
              "sha256": "ab0e7999cf202cc72962c78aefe461d16497b3c1a8282ab966ad90b6cb271096"
            },
            {
              "type": "script",
              "commands": [
                "python3 configure.py \\",
                "--confirm-license \\",
                "--assume-shared \\",
                "--no-designer-plugin \\",
                "--no-docstrings \\",
                "--no-tools \\",
                "--no-qsci-api \\",
                "--destdir=/app/lib/python3.5/site-packages \\",
                "--stubsdir=/app/lib/python3.5/site-packages \\",
                "--sipdir=/app/share/sip"
              ],
              "dest-filename": "configure"
            }
          ],
          "modules": [{
            "name": "sip",
            "sources": [
              {
                "type": "archive",
                "url": "https://sourceforge.net/projects/pyqt/files/sip/sip-4.19.3/sip-4.19.3.tar.gz",
                "sha256": "740df844f80cc45dcc9b23294a92492923bc403ce88e68c35783f27c177c4b74"
              },
              {
                "type": "script",
                "commands": [
                  "python3 configure.py \\",
                  "--bindir=/app/bin \\",
                  "--destdir=/app/lib/python3.5/site-packages \\",
                  "--incdir=/app/include \\",
                  "--pyidir=/app/lib/python3.5/site-packages \\",
                  "--sipdir=/app/share/sip"
                ],
                "dest-filename": "configure"
              }
            ]
          }]
        },
        {
          "name": "ffmpeg",
          "config-opts": [
            "--enable-shared",
            "--disable-static",
            "--disable-doc",
            "--disable-ffplay",
            "--disable-ffprobe",
            "--disable-ffserver",
            "--disable-devices",
            "--enable-gnutls",
            "--enable-gpl",
            "--enable-libfreetype",
            "--enable-libmp3lame",
            "--enable-libvorbis",
            "--enable-libvpx",
            "--enable-libx264",
            "--enable-libxcb",
            "--enable-libxvid",
            "--disable-cuda",
            "--disable-cuvid"
          ],
          "sources": [{
            "type": "archive",
            "url": "https://ffmpeg.org/releases/ffmpeg-3.3.2.tar.xz",
            "sha256": "1998de1ab32616cbf2ff86efc3f1f26e76805ec5dc51e24c041c79edd8262785"
          }],
          "cleanup": ["/share"],
          "modules": [
            {
              "name": "lame",
              "config-opts": [
                "--disable-static",
                "--disable-frontend",
                /* Disable docs */
                "--datarootdir=/"
              ],
              "sources": [{
                "type": "archive",
                "url": "https://downloads.sourceforge.net/lame/lame-3.99.5.tar.gz",
                "sha256": "24346b4158e4af3bd9f2e194bb23eb473c75fb7377011523353196b19b9a23ff"
              }]
            },
            {
              "name": "libx264",
              "config-opts": [
                "--enable-shared",
                "--disable-cli"
              ],
              "sources": [{
                "type": "git",
                "url": "https://git.videolan.org/git/x264.git",
                "branch": "stable",
                "commit": "aaa9aa83a111ed6f1db253d5afa91c5fc844583f"
              }]
            },
            {
              "name": "xvid",
              "subdir": "build/generic",
              "sources": [{
                "type": "archive",
                "url": "http://downloads.xvid.org/downloads/xvidcore-1.3.4.tar.bz2",
                "sha256": "5faf6380b828db8ad29f0b69f030edf86d0fe26d1f9c5427030c6accd3ad8bf7"
              }],
              "cleanup": ["/lib/libxvidcore.a"]
            }
          ]
        },
        {
          "name": "numpy",
          "buildsystem": "simple",
          "build-commands": [
            "pip3 install --prefix=/app --no-deps --verbose ."
          ],
          "sources": [{
            "type": "archive",
            "url": "https://github.com/numpy/numpy/releases/download/v1.13.1/numpy-1.13.1.tar.gz",
            "sha256": "de020ec06f1e9ce1115a50161a38bf8d4c2525379900f9cb478cc613a1e7cd93"
          }]
        },
        {
          "name": "pillow-simd",
          "buildsystem": "simple",
          "build-commands": [
            "python3 setup.py install --prefix=/app --root=/ --optimize=1"
          ],
          "sources": [{
            "type": "archive",
            "url": "https://pypi.python.org/packages/b0/d7/c671de32baf7a5e8a9a505096b004b285b83963a49dd0bd0b1c3c16b7b3d/Pillow-SIMD-4.1.1.post0.tar.gz",
            "sha256": "09e5c8e4835db7cc90a0b9ad305a2d280a69f4e5fb3371dcc4abde86b41ecc0b"
          }],
          "modules": [{
            "name": "olefile",
            "buildsystem": "simple",
            "build-commands": [
              "python3 setup.py install --prefix=/app --root=/ --optimize=1"
            ],
            "sources": [{
              "type": "archive",
              "url": "https://github.com/decalage2/olefile/releases/download/v0.44/olefile-0.44.tar.gz",
              "sha256": "021fbed5c539881d7f1360fb27e942fdfa7c78006bed39e6cd6f3dd9e7bd68da"
            }]
          }]
        }
      ]
    }
  ]
}
