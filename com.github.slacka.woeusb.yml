id: com.github.slacka.woeusb
# Uses lsblk, directly
runtime: org.gnome.Sdk
runtime-version: 3.28
sdk: org.gnome.Sdk
command: woeusbgui
#rename-icon: pulseeffects
finish-args:
    # X11 + XShm access
  - --share=ipc
  - --socket=x11
    # Wayland access
  - --socket=wayland
    # Dconf access
  - --env=DCONF_USER_CONFIG_DIR=.config/dconf
  - --filesystem=xdg-run/dconf
  - --filesystem=~/.config/dconf:ro
  - --talk-name=ca.desrt.dconf
    # Storage device access
  - --device=all
    # wxwidgets does not support portals
  - --filesystem=home
cleanup:
  - '*.a'
  - '*.h'
  - '*.la'
  - /include
  - /lib/pkgconfig

modules:
  - name: woeusb
    sources:
      - type: git
        url: 'https://github.com/slacka/WoeUSB.git'
        tag: v3.2.1
        commit: 1aaec5f40e5be151312941c1129c572be917c2e0
      - type: shell
        commands:
          - ./setup-development-environment.bash
      - type: script
        dest-filename: autogen.sh
        commands:
          - autoreconf -vfi
    post-install:
      - install -Dm644 -t /app/share/licenses/com.github.slacka.woeusb COPYING
    modules:

      - name: wxwidgets
        config-opts:
          - --disable-webkit
          - --disable-webview
          - --disable-webviewwebkit
          - --without-subdirs
          - --with-gtk=3
          - --without-gtkprint
        sources:
          - type: archive
            url: 'https://github.com/wxWidgets/wxWidgets/releases/download/v3.0.4/wxWidgets-3.0.4.tar.bz2'
            sha1: 246561a73ec5b9a5a7aaaaed46b64515dc9039ab
        post-install:
          - install -Dm644 -t /app/share/licenses/wxwidgets docs/gpl.txt
                                                            docs/lgpl.txt
                                                            docs/licence.txt
                                                            docs/licendoc.txt

      - name: pkexec
        sources:
          - type: git
            url: 'https://anongit.freedesktop.org/git/polkit'
            tag: 0.114
            commit: ed06baed179166389d536420a6fc532781d48178
