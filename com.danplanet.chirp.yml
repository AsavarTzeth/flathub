id: com.danplanet.chirp
branch: gtk3
runtime: org.gnome.Platform
runtime-version: 3.28
sdk: org.gnome.Sdk
command: chirpw
rename-desktop-file: chirp.desktop
rename-icon: chirp
copy-icon: true
finish-args:
    # X11 + XShm access
  - --share=ipc
  - --socket=x11
    # Device access (radios)
  - --device=all
cleanup:
  - '*.a'
  - '*.h'
  - '*.la'
  - /include
  - /lib/pkgconfig

modules:

  - name: chirp
    buildsystem: simple
    build-commands:
      - python2 setup.py install --prefix=/app --root=/ --optimize=1
    sources:
      - type: archive
        url: 'https://trac.chirp.danplanet.com/chirp_daily/LATEST/chirp-daily-20180811.tar.gz'
        sha256: c536994f594277ccd7016fe69bef13ec660c215982b4a148d52fe876acf0f9f4
      - type: patch
        path: patch/chirp/0001-Fix-issues-with-setup.py-installation-paths.patch
      - type: patch
        path: patch/chirp/0002-Add-support-for-xdg-base-directories.patch
      - type: patch
        path: patch/chirp/0001-Initial-work-towards-GTK3.patch
      - type: patch
        path: patch/chirp/0002-Fix-xdg-base-directories-gtk3-support.patch
      - type: file
        dest-filename: share/chirp.svg
        url: https://chirp.danplanet.com/projects/chirp/repository/revisions/85b213f6d01a/raw/share/chirp.svg
        sha512: de77ecd0acd54af2e97932213a087470f6bfa2a26a1c40ef5ac703fb5df521d1c3090689c516dc56f5864729d1175baff495ab19f9a55be416d0168f2c56bfa6
    cleanup:
      - /bin/rpttool
      - /share/man
    post-install:
      - install -Dm644 -t /app/share/icons/hicolor/scalable/apps share/chirp.svg
    modules:

      - name: python2-pyserial
        buildsystem: simple
        build-commands:
          - python2 setup.py install --prefix=/app --root=/ --optimize=1
        sources:
          - type: git
            url: 'https://github.com/pyserial/pyserial.git'
            tag: v3.2.1
            commit: ffb44d6d7394e2b73bfb1bb91dd69c377c0f8aa0
        post-install:
          - install -Dm644 -t /app/share/licenses/python2-pyserial LICENSE.txt
        cleanup:
          - /bin/miniterm.py

      - name: python2-lxml
        buildsystem: simple
        build-commands:
          - python2 setup.py build
          - python2 setup.py install --prefix=/app --root=/ --optimize=1
        build-options:
          env:
            XSLT_CONFIG: pkg-config libxslt
        sources:
          - type: archive
            url: 'https://files.pythonhosted.org/packages/ca/63/139b710671c1655aed3b20c1e6776118c62e9f9311152f4c6031e12a0554/lxml-4.2.4.tar.gz'
            sha256: e2afbe403090f5893e254958d02875e0732975e73c4c0cdd33c1f009a61963ca
        post-install:
          - install -Dm644 -t /app/share/licenses/python2-lxml LICENSES.txt
                           ./doc/licenses/BSD.txt ./doc/licenses/elementtree.txt
                           ./doc/licenses/GPL.txt ./doc/licenses/ZopePublicLicense.txt

      - name: python2-cairo
        buildsystem: simple
        build-commands:
          - python2 setup.py install --prefix=/app --root=/ --optimize=1
        sources:
          - type: git
            url: 'https://github.com/pygobject/pycairo.git'
            branch: v1.17.1
            commit: df9b51e344a5ee5763ed1c320dc3385782e0bbae
        post-install:
          - install -Dm644 -t /app/share/licenses/python2-cairo COPYING COPYING-MPL-1.1

      - name: python2-gobject
        build-options:
          env:
            PYTHON: python2
        sources:
          - type: archive
            url: 'https://download.gnome.org/sources/pygobject/3.28/pygobject-3.28.3.tar.xz'
            sha256: 3dd3e21015d06e00482ea665fc1733b77e754a6ab656a5db5d7f7bfaf31ad0b0
        post-install:
          - install -Dm644 -t /app/share/licenses/python2-gobject COPYING
        cleanup:
          - /bin
          - /share/gtk-doc
