app-id: au.com.glassechidna.heimdall
runtime: org.kde.Platform
runtime-version: 5.10
sdk: org.kde.Sdk
command: heimdall-frontend
finish-args:
    # X11 + XShm access
  - --share=ipc
  - --socket=x11
    # Wayland access
  - --socket=wayland
    # Mobile Device (USB) access
  - --device=all
cleanup:
  - '*.a'
  - '*.h'
  - '*.la'
  - /include
  - /lib/pkgconfig
modules:
  - name: heimdall
    builddir: true
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    # Install target is fixed for the next release
    no-make-install: true
    sources:
      - type: git
        url: 'https://github.com/Benjamin-Dobell/Heimdall.git'
        tag: v1.4.2
        commit: 699549e3c661e868656147cdad35189469198f4d
      - type: file
        path: au.com.glassechidna.heimdall.appdata.xml
      - type: file
        path: au.com.glassechidna.heimdall.desktop
      - type: file
        path: au.com.glassechidna.heimdall.svg
    post-install:
      - |
        install -Dm755 -t /app/bin bin/heimdall bin/heimdall-frontend
        install -Dm644 -t /app/share/appdata ../au.com.glassechidna.heimdall.appdata.xml
        install -Dm644 -t /app/share/applications ../au.com.glassechidna.heimdall.desktop
        install -Dm644 -t /app/share/icons/hicolor/scalable/apps ../au.com.glassechidna.heimdall.svg
        install -Dm644 -t /app/share/licenses/au.com.glassechidna.heimdall ../LICENSE
    modules:

      - name: libusb
        config-opts:
          - --disable-static
          - --disable-udev
          - --prefix=/app
        sources:
          - type: git
            url: 'https://github.com/libusb/libusb.git'
            tag: v1.0.22
            commit: 0034b2afdcdb1614e78edaa2a9e22d5936aeae5d
        post-install:
          - install -Dm644 -t /app/share/licenses/libusb COPYING
